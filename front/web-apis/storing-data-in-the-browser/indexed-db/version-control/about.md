–û—Ç–ª–∏—á–Ω–æ, —Ç–µ–º–∞ **version control** –≤ IndexedDB –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤–∞–∂–Ω–∞—è!  
–ü–æ–≥–Ω–∞–ª–∏! –í—Å—ë –æ–±—ä—è—Å–Ω—é —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ **–∫–æ–¥ + –ø–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏** (–∫–∞–∫ —Ç—ã –ø–æ–ø—Ä–æ—Å–∏–ª).

---

# üìö –ß—Ç–æ —Ç–∞–∫–æ–µ Version Control –≤ IndexedDB

- –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –±–∞–∑—ã —á–µ—Ä–µ–∑ `indexedDB.open("DBName", version)` –º—ã –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ–º —É–∫–∞–∑–∞—Ç—å **–Ω–æ–º–µ—Ä –≤–µ—Ä—Å–∏–∏**.
- **–í–µ—Ä—Å–∏—è ‚Äî —ç—Ç–æ –∫–æ–Ω—Ç—Ä–æ–ª—å —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∫–∏–µ objectStore'—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç, –∫–∞–∫–∏–µ –∏–Ω–¥–µ–∫—Å—ã –µ—Å—Ç—å).
- –ï—Å–ª–∏ —É–∫–∞–∑–∞—Ç—å –≤–µ—Ä—Å–∏—é –±–æ–ª—å—à–µ —Ç–µ–∫—É—â–µ–π ‚Üí –±—Ä–∞—É–∑–µ—Ä –≤—ã–∑–æ–≤–µ—Ç —Å–æ–±—ã—Ç–∏–µ `onupgradeneeded`.
- –¢–∞–º –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å/–æ–±–Ω–æ–≤–ª—è—Ç—å objectStore'—ã, –∏–Ω–¥–µ–∫—Å—ã –∏ —Ç.–¥.

---

# üìÑ –ü—Ä–∏–º–µ—Ä 1: –ü–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è –ë–î

```javascript
const request = indexedDB.open("MyDB", 1);

request.onupgradeneeded = function(event) {
  const db = event.target.result;

  // –°–æ–∑–¥–∞—ë–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ "users" —Å –∫–ª—é—á–æ–º –ø–æ –ø–æ–ª—é "id"
  const store = db.createObjectStore("users", { keyPath: "id" });

  console.log("–°–æ–∑–¥–∞–Ω–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ users –≤ –≤–µ—Ä—Å–∏–∏ 1");
};

request.onsuccess = function(event) {
  const db = event.target.result;
  console.log("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç–∫—Ä—ã—Ç–∞ —É—Å–ø–µ—à–Ω–æ.");
};
```

---

# üìÑ –ü—Ä–∏–º–µ—Ä 2: –ü–æ–≤—ã—à–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

–î–æ–ø—É—Å—Ç–∏–º, —Ç–µ–ø–µ—Ä—å –º—ã —Ö–æ—Ç–∏–º –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ `"orders"`.

```javascript
const request = indexedDB.open("MyDB", 2); // –£–∫–∞–∑—ã–≤–∞–µ–º –≤–µ—Ä—Å–∏—é 2 (–±–æ–ª—å—à–µ —á–µ–º 1)

request.onupgradeneeded = function(event) {
  const db = event.target.result;

  if (!db.objectStoreNames.contains("orders")) {
    // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ "orders"
    db.createObjectStore("orders", { keyPath: "orderId" });
    console.log("–°–æ–∑–¥–∞–Ω–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ orders –≤ –≤–µ—Ä—Å–∏–∏ 2");
  }
};

request.onsuccess = function(event) {
  const db = event.target.result;
  console.log("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç–∫—Ä—ã—Ç–∞ —É—Å–ø–µ—à–Ω–æ.");
};
```

---

# üìÑ –ü—Ä–∏–º–µ—Ä 3: –ü–æ–≤—ã—à–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∏–Ω–¥–µ–∫—Å–∞

–î–æ–ø—É—Å—Ç–∏–º, —Ç–µ–ø–µ—Ä—å —Ö–æ—Ç–∏–º –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å –ø–æ –ø–æ–ª—é `email` –≤ `"users"`.

```javascript
const request = indexedDB.open("MyDB", 3); // –í–µ—Ä—Å–∏—è 3

request.onupgradeneeded = function(event) {
  const db = event.target.result;

  const userStore = request.transaction.objectStore("users");

  // –°–æ–∑–¥–∞—ë–º –∏–Ω–¥–µ–∫—Å –ø–æ –ø–æ–ª—é email
  userStore.createIndex("emailIndex", "email", { unique: true });

  console.log("–î–æ–±–∞–≤–ª–µ–Ω –∏–Ω–¥–µ–∫—Å emailIndex –≤ users –≤ –≤–µ—Ä—Å–∏–∏ 3");
};

request.onsuccess = function(event) {
  const db = event.target.result;
  console.log("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç–∫—Ä—ã—Ç–∞ —É—Å–ø–µ—à–Ω–æ.");
};
```

---

# üß† –ß—Ç–æ –≤–∞–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –≤–µ—Ä—Å–∏—è–º–∏

| –ü—Ä–∞–≤–∏–ª–æ | –ü–æ—è—Å–Ω–µ–Ω–∏–µ |
|:--------|:----------|
| –í–µ—Ä—Å–∏—è –≤—Å–µ–≥–¥–∞ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ | –¢–æ–ª—å–∫–æ –≤–≤–µ—Ä—Ö, –Ω–µ–ª—å–∑—è "–ø–æ–Ω–∏–∑–∏—Ç—å" –±–∞–∑—É |
| `onupgradeneeded` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–≤—ã—à–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏ | –¢–∞–º –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å/—É–¥–∞–ª—è—Ç—å/–º–µ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É |
| `request.transaction` –¥–æ—Å—Ç—É–ø–Ω–∞ –≤–Ω—É—Ç—Ä–∏ `onupgradeneeded` | –ü–æ–∑–≤–æ–ª—è–µ—Ç –º–∞–Ω–∏–ø—É–ª–∏—Ä–æ–≤–∞—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞–º–∏ –∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏ |
| –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–∞–º | –í –æ–±—ã—á–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ–ª—å–∑—è —Å–æ–∑–¥–∞–≤–∞—Ç—å/—É–¥–∞–ª—è—Ç—å objectStore |

---

# üìÑ –ü—Ä–∏–º–µ—Ä 4: –ú–∏–≥—Ä–∞—Ü–∏–∏ —Å —É—á—ë—Ç–æ–º —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏

–ï—Å–ª–∏ —Ö–æ—Ç–∏–º –ø–∏—Å–∞—Ç—å –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π **–ø–æ–Ω–∏–º–∞–µ—Ç, —Å –∫–∞–∫–æ–π –≤–µ—Ä—Å–∏–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–ø–≥—Ä–µ–π–¥**:

```javascript
const request = indexedDB.open("MyDB", 4); // –ü–æ–¥–Ω–∏–º–∞–µ–º –≤–µ—Ä—Å–∏—é –¥–æ 4

request.onupgradeneeded = function(event) {
  const db = event.target.result;
  const oldVersion = event.oldVersion; // –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è –±–∞–∑—ã
  const newVersion = event.newVersion; // –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –±–∞–∑—ã

  console.log(`–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã —Å –≤–µ—Ä—Å–∏–∏ ${oldVersion} –Ω–∞ ${newVersion}`);

  if (oldVersion < 2) {
    db.createObjectStore("orders", { keyPath: "orderId" });
  }

  if (oldVersion < 3) {
    const userStore = request.transaction.objectStore("users");
    userStore.createIndex("emailIndex", "email", { unique: true });
  }

  if (oldVersion < 4) {
    const orderStore = request.transaction.objectStore("orders");
    orderStore.createIndex("createdAtIndex", "createdAt", { unique: false });
  }
};

request.onsuccess = function(event) {
  const db = event.target.result;
  console.log("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç–∫—Ä—ã—Ç–∞ —É—Å–ø–µ—à–Ω–æ.");
};
```

---

# ‚ú® –ö—Ä–∞—Ç–∫–∏–π –∏—Ç–æ–≥:

| –ß—Ç–æ –≤–∞–∂–Ω–æ | –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç |
|:----------|:-----------------|
| –ö–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π —á–µ—Ä–µ–∑ `open("name", version)` | –í–µ—Ä—Å–∏—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É |
| –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–µ–ª–∞—é—Ç—Å—è –≤ `onupgradeneeded` | –¢–æ–ª—å–∫–æ —Ç–∞–º –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å/—É–¥–∞–ª—è—Ç—å objectStore –∏ –∏–Ω–¥–µ–∫—Å—ã |
| –ú–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ | –ü—Ä–æ–≤–µ—Ä—è–µ—à—å `event.oldVersion` –∏ –¥–µ–ª–∞–µ—à—å –Ω—É–∂–Ω—ã–µ —à–∞–≥–∏ |

---

‚úÖ –í—Å—ë, –≤–æ—Ç —Ç–∞–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É—Å—Ç—Ä–æ–µ–Ω **Version Control** –≤ IndexedDB.

---

–•–æ—á–µ—à—å, –¥–∞–ª—å—à–µ –º–æ–∂–µ–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å:
- –∫–∞–∫ **—É–¥–∞–ª–∏—Ç—å** `objectStore` –∏–ª–∏ `index` –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏;
- –∫–∞–∫ **–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å** –ø–æ–ª–µ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ (—á–µ—Ä–µ–∑ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞).

–°–∫–∞–∑–∞—Ç—å "–¥–∞"? üöÄ